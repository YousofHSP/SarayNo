@using Domain
@model List<Presentation.DTO.ProjectResDto>

@{
    ViewData["Title"] = "لیست پروژه ها";
    Layout = "_Layout";
}

<div class="card">
    <div class="card-body">

        <div class="d-flex justify-content-between">
            <a asp-action="Create" asp-area="Admin" class="btn btn-primary">افزودن</a>
        </div>
        <ul class="mt-2 nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="estimate-tab" data-bs-toggle="tab"
                        data-bs-target="#estimate-tab-pane"
                        type="button" role="tab" aria-controls="estimate-tab-pane" aria-selected="true">برآورد و تخمین
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="real-tab" data-bs-toggle="tab" data-bs-target="#real-tab-pane"
                        type="button" role="tab" aria-controls="real-tab-pane" aria-selected="false"> متراژ و قیمت
                    اجرا شده
                </button>
            </li>
        </ul>
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="estimate-tab-pane" role="tabpanel" aria-labelledby="estimate-tab"
                 tabindex="0">
                <table class="table table-hover mt-2">
                    <thead>
                    <tr>
                        <td>عنوان</td>
                        <td>درصد</td>
                        <td>تاریخ</td>
                        <td>قیمت</td>
                        <td>عملیات</td>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach (var item in Model)
                    {
                        var estimatePrice = item.EstimatePrice;
                        if (estimatePrice == 0)
                            estimatePrice = item.Details.Where(i => i.Type == ProjectDetailType.Estimate).Sum(i => i.TotalPrice);
                        <tr>
                            <td>@item.Title</td>
                            <td>@item.Percent</td>
                            <td>@item.Date</td>
                            <td>@estimatePrice</td>
                            <td>

                                <div class="dropdown d-inline-block">
                                    <a class="nav-link" style="padding: .5rem 1rem"
                                       data-bs-toggle="dropdown"
                                       href="#" role="button" aria-haspopup="false" aria-expanded="false">
                                        <i class="fa fa-ellipsis-v font-20 text-muted"></i>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="dLabel6" x-placement="bottom-start"
                                         style="text-align: right;position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 36px, 0px);">
                                        <a asp-area="Admin" asp-action="Edit" asp-route-id="@item.Id"
                                           class="dropdown-item">
                                            <i
                                                class="fa fa-pencil"></i>
                                            ویرایش
                                        </a>
                                        <a asp-area="Admin" asp-action="EstimateDetails" asp-route-id="@item.Id"
                                           class="dropdown-item">
                                            <i
                                                class="fa fa-list"></i>
                                            جزئیات
                                        </a>
                                    </div>
                                </div>

                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
            <div class="tab-pane fade" id="real-tab-pane" role="tabpanel" aria-labelledby="real-tab" tabindex="0">
                <table class="table table-hover mt-2">
                    <thead>
                    <tr>
                        <td>عنوان</td>
                        <td>درصد</td>
                        <td>تاریخ</td>
                        <td>قیمت</td>
                        <td>تفاوت</td>
                        <td>عملیات</td>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach (var item in Model)
                    {
                        var finalPrice = item.FinalPrice;
                        if (finalPrice == 0)
                            finalPrice = item.Details.Where(i => i.Type == ProjectDetailType.Final).Sum(i => i.TotalPrice);
                        var estimatePrice = item.EstimatePrice;
                        if (estimatePrice == 0)
                            estimatePrice = item.Details.Where(i => i.Type == ProjectDetailType.Estimate).Sum(i => i.TotalPrice);
                        <tr>
                            <td>@item.Title</td>
                            <td>@item.Percent</td>
                            <td>@item.Date</td>
                            <td>@finalPrice</td>
                            <td>@(finalPrice - estimatePrice)</td>
                            <td>

                                <div class="dropdown d-inline-block">
                                    <a class="nav-link" style="padding: .5rem 1rem"
                                       data-bs-toggle="dropdown"
                                       href="#" role="button" aria-haspopup="false" aria-expanded="false">
                                        <i class="fa fa-ellipsis-v font-20 text-muted"></i>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="dLabel6" x-placement="bottom-start"
                                         style="text-align: right;position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 36px, 0px);">
                                        <a asp-area="Admin" asp-action="Edit" asp-route-id="@item.Id"
                                           class="dropdown-item">
                                            <i
                                                class="fa fa-pencil"></i>
                                            ویرایش
                                        </a>
                                        <a asp-area="Admin" asp-action="FinalDetails" asp-route-id="@item.Id"
                                           class="dropdown-item">
                                            <i
                                                class="fa fa-list"></i>
                                            جزئیات
                                        </a>
                                    </div>
                                </div>

                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>